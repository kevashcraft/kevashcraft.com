{% extends 'templates/master.twig' %}

{% set title = 'CentOS 7.4 Basic Configuration' %}

{% block content %}
<section>
  <h3><a href="/centos-7.4/basic-configuration" title="CentOS 7.4 Basic Configuration">CentOS 7.4 Basic Configuration</a></h3>
  <div class="flex">
    <div>
      <img src="/img/common/centos-logo.png">
    </div>
    <div class="stretch">
      <p>After installing CentOS there are a few basic configurations to make to ensure you've got basic security and easy  access. The first thing we'll do is <a href="#admin-user" title="useradd $username -G $username wheel">add an add an admin user</a> and <a href="#first-update" title="yum update && yum install vim wget rsync">update the system</a>, and then <a href="#ssh-access" title="/etc/ssh/sshd_config AllowUsers PasswordAuthentication">lockdown ssh access with a few settings</a> and a <a href="#firewall-rules" title="/etc/firewalld/zones/public.xml">firewall</a>, next we'll <a href="#selinux-status" title="getenforce  -  /etc/sysconfig/selinux">check on SELinux</a>, <a href="#network-status" title="ip a  -  /etc/sysconfig/network-scripts/ifcg*">check on the network</a>, <a href="#hostname-dns" title="/etc/hostname  -  /etc/resolv.conf">set the hostname and dns</a>, and then <a href="#motd-message" title="/etc/motd  -  /etc/motd.sh">add a login message of the day</a>. There will also be some useful <a href="#keyboard-shortcuts" title="ctrl+r  -  ctrl+shift+c/v  -  ctrl+l  -  ctrl+d">keyboard shortcuts</a> and <a href="#useful-commands" title="wall  -  w  -  netstat  -  ps aux  -  grep  -  cat  -  head  -  tail">commands</a>.</p>
    </div>
  </div>
  <div class="indent">
    <h5>Configuration Steps</h5>
    <ul>
      <li><a href="#admin-user" title="useradd $username -G $username wheel">Add an Admin User</a></li>
      <li><a href="#first-update" title="yum update && yum install vim wget rsync">Update the System</a></li>
      <li><a href="#ssh-access" title="/etc/ssh/sshd_config AllowUsers PasswordAuthentication">Lockdown SSH Access</a></li>
      <li><a href="#firewall-rules" title="/etc/firewalld/zones/public.xml">Add Firewall Rules</a></li>
      <li><a href="#selinux-status" title="getenforce  -  /etc/sysconfig/selinux">Check SELinux Status</a></li>
      <li><a href="#network-status" title="ip a  -  /etc/sysconfig/network-scripts/ifcg*">Check Network Status</a></li>
      <li><a href="#hostname-dns" title="/etc/hostname  -  /etc/resolv.conf">Set Hostname and DNS</a></li>
      <li><a href="#motd-message" title="/etc/motd  -  /etc/motd.sh">Add a Message of the Day</a></li>
    </ul>
  </div>
  <div class="indent">
    <h5>Bonus Steps</h5>
    <ul>
      <li><a href="#keyboard-shortcuts" title="ctrl+r  -  ctrl+shift+c/v  -  ctrl+l  -  ctrl+d">Keyboard Shortcuts</a></li>
      <li><a href="#useful-commands" title="wall  -  w  -  netstat  -  ps aux  -  grep  -  cat  -  head  -  tail">Useful Commands</a></li>
    </ul>
  </div>
  <div class="indent">
    <h5>Useful Notes</h5>
    <p>use <code>sudo</code> to run commands as root</p>
  </div>
</section>
<section id="admin-user">
  <h4><a href="#admin-user">Add an Admin User</a></h4>
  <div class="snippet one-line"><pre>useradd <em>$username</em> -G $username wheel</pre></div>
  <p>You can add an admin user (<strong>a user with sudo access</strong>) by adding a user to the <i>wheel</i> group. To add a new user and <strong>add them to the <i>wheel</i> group</strong>, include the <span class="command">-G</span> flag when you run <span class="code">adduser</span>.</p>
  <p>To add an <strong>existing user</strong> to the <i>wheel</i> group run <span class="command">usermod -a -G wheel $username</span>.</p>
  <p><img class="symbol" src="/img/common/warning.png"> The <strong>name of the privileged group</strong> can be set with the<span class="command">visudo</span> command, which saves the configuration (after it checks to make sure nothing is broken) to <span class="filepath">/etc/sudoers</span>. <strong>Do not edit this file</strong> manually as it can break <span class="command">sudo</span> and lock you out. The line you're looking for is <span class="snippet">%wheel   ALL=(ALL:ALL) ALL</span>, which grants the <i>wheel</i> group access to ALL.</p>
  <p class="em">Adding an admin user is an important security point to ensure your permissions are set from the beginning and you're not just going around and rooting into everything.</p>
</section>
<section id="first-update">
  <h4><a href="#first-update">Update the System</a></h4>
  <div class="snippet one-line"><pre>yum update && yum install vim wget rsync</pre></div>
  <p>You can update the system by running <span class="command">yum update</span> and you can install software packages with the <span class="command">yum install $packages</span> command. Above we added the <span class="snippet">&&</span> between the two commands so one is ran after the other. You could also add the <span class="snippet">-y</span> flag to automatically accept the questions and do everything at once.</p>
</section>
<section id="ssh-access">
  <h4><a href="#ssh-access">Lockdown SSH Access</a></h4>
  <div class="snippet">
    <p class="filename">/etc/ssh/sshd_config</p>
    <p class="note">Find and update or add these lines</p>
    <pre>
# space-separated list of user allowes to login
AllowUsers $usernames

# disable password authentication
PasswordAuthentication no
    </pre>
  </div>
  <p>Two of the most important steps in securing SSH access are restricting which users are allowed to login and requiring those with access to use keyfiles. To <strong>only allow specific users to have SSH access</strong> add/edit the <span class="snippet">AllowUsers</span> line with a list of users (separated by spaces). Requiring a keyfile to login is done by disabling <span class="snippet">PasswordAuthentication</span>.</p>
</section>
<section id="firewall-rules">
  <h4><a href="#firewall-rules">Add Firewall Rules</a></h4>
  <div class="snippet">
    <p class="filename">/etc/firewalld/zones/public.xml</p>
    <pre>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;zone>
  &lt;short>Public&lt;/short>
  <span>## listen to only your ip address for ssh access</span>
  &lt;rule family="ipv4"&gt;
    &lt;source address="<em>$your_current_ip_address</em>"/&gt;
    &lt;service name="ssh"/&gt;
    &lt;accept /&gt;
  &lt;/rule&gt;

  <span>## add a port for a service</span>
  <span># &lt;service name="<em>$service</em>"/&gt;</span>
  <span>## add a port and protocol</span>
  <span># &lt;port port="<em>$port</em>" protocol="<em>$protocol</em>"/&gt;</span>
&lt;/zone&gt;
    </pre>
  </div>
  <p>The firewall (iptables) is <strong>configured with the <i>firewalld</i> service</strong>. It can be updated with the <span class="command">firewall-cmd</span> command or via the zone files (like above).</p>
  <div class="snippet">
    <p class="description">start, enable, and check the status of the firewall</p>
    <pre>
systemctl start firewalld
systemctl enable firewalld
systemctl status firewalld
    </pre>
  </div>
  <div class="snippet">
    <p class="description">open a port in the firewall</p>
    <pre>
<span># temporarily add a port</span>
firewall-cmd --add-port=80/tcp
<span># permanently add a port</span>
firewall-cmd --add-service=http --permanent
firewall-cmd --reload
    </pre>
  </div>
  <p>FirewallD is just one of the many ways to configure <i>iptables</i> which controls the traffic rules. You can see all of the rules in effect by running <span class="command">iptables -L</span>.</p>
</section>
<section id="selinux-status">
  <h4><a href="#selinux-status">Check SELinux Status</a></h4>
  <div class="snippet">
    <p class="description">check if SELinux is enforcing</p>
    <pre>
getenforce
    </pre>
  </div>
  <div class="snippet">
    <p class="description">start/stop SELinux enforcement</p>
    <pre>
setenforce 1
<span>## 0 to disable</span>
<span># setenforce 0</span>
    </pre>
  </div>
  <div class="snippet">
    <p class="filename">/etc/sysconfig/selinux</p>
    <pre>
<span>## set to enforcing or permissive</span>
SELINUX=enforcing
SELINUXTYPE=targeted
    </pre>
  </div>
  <p>SELinux stands for <strong>Security Enhanced Linux</strong> and further locks down a system, restricting file and network access based on specific policies in addition to the standard filesystem permissions. You can check if SELinux is currently enforicing policies by running the <span class="command">getenforce</span> command, and to temporarily enable/disable SELinux run <span class="command">setenforce 1/0</span>. To make permanent changes edit the <span class="filepath">/etc/sysconfig/selinux</span> file, setting <span class="snippet">SELINUX</span> to enforcing or permissive.</p>
  <p>SELinux is <strong>enabled by default on CentOS</strong> and is a good idea/challenge to keep it on, however just remember <strong class="light">if you're encountering a permission problem, there's a good chance that SELinux is to blame.</strong></p>
</section>
<section id="network-status">
  <h4><a href="#network-status">Check Network Status</a></h4>
  <div class="snippet">
    <p class="description">display network addresses</p>
    <pre>ip a</pre>
  </div>
  <div class="snippet">
    <p class="filename">/etc/sysconfig/network-scripts/ifcfg-<em>$eth_device</em></p>
    <pre>
<span>## turn onboot to yes to start the card on system boot</span>
ONBOOT="yes"
<span>## set bootproto to dhcp/static/none (for bridge)</span>
BOOTPROTO=static
<span>## set ip addresses if static</span>
IPADDR=10.0.0.2
PREFIX=24
GATEWAY=10.0.0.1
DNS1=8.8.8.8
DNS2=8.8.4.4
<span>## Assigns the device to a bridge</span>
<span># BRIDGE=br0</span>
    </pre>
    <p class="note">for a bridge device</p>
    <pre>
DEVICE="br0"
TYPE=Bridge
DELAY=0
    </pre>
  </div>
  <p>The network addresses can be found with the <span class="command">ip a</span> command and the device settings can be edited in the <code>/etc/sysconfig/network-scripts/ifcfg-$eth_device</code> file.</p>
  <p>Changing the <span class="snippet">BOOTPROTO</span> to dhcp/static will control the address assignment.</p>
  <p>Creating a <span class="filepath">ifcfg-br0</span> file with the above lines changed will create a bridge device (useful for kvm).</p>
</section>
<section id="hostname-dns">
  <h4><a href="#hostname-dns">Set Hostname and DNS</a></h4>
  <div class="snippet">
    <p class="description">set the hostname (until next boot)</p>
    <pre>hostname <em>$hostname</em></pre>
  </div>
  <div class="snippet">
    <p class="filename">/etc/hostname</p>
    <pre><em>$hostname</em></pre>
  </div>
  <div class="snippet">
    <p class="filename">/etc/resolv.conf</p>
    <pre>
nameserver 8.8.8.8
nameserver 8.8.4.4
    </pre>
  </div>
  <p>The system's hostname can be temporarily changed with the <span class="command">hostname</span> command and permanently changed by editing the <code>/etc/hostname</code> file with the new name.</p>
  <p>You can set the nameservers in the <code>/etc/resolv.conf</code> file.</p>
</section>
<section id="motd-message">
  <h4><a href="#motd-message">Add a Message of the Day</a></h4>
  <div class="snippet">
    <p class="filename">vim /etc/motd</p>
    <pre>
  ____           _    ___  ____    _____
 / ___|___ _ __ | |_ / _ \/ ___|  |___  |
| |   / _ \ '_ \| __| | | \___ \     / /
| |__|  __/ | | | |_| |_| |___) |   / /
 \____\___|_| |_|\__|\___/|____/   /_/
    </pre>
  </div>
  <p>If you want to see a message whenever you login add it to the <code>/etc/motd</code> file. This is a good place to add that timeless ascii art you've been saving.</p>
</section>
<section id="keyboard-shortcuts">
  <h4><a href="#keyboard-shortcuts">Keyboard Shortcuts</a></h4>
  <div class="snippet">
    <p class="description">search command history</p>
    <pre>ctrl+r</pre>
  </div>
  <div class="snippet">
    <p class="description">copy/paste in a gui terminal</p>
    <pre>ctrl+shift+c and ctrl+shift+v</pre>
  </div>
  <div class="snippet">
    <p class="description">clear the screen</p>
    <pre>ctrl-l</pre>
  </div>
  <div class="snippet">
    <p class="description">logout</p>
    <pre>ctrl-d</pre>
  </div>
</section>
<section id="useful-commands">
  <h4><a href="#useful-commands">Useful Commands</a></h4>
  <div class="snippet">
    <p class="description">show who all is logged in</p>
    <pre>w</pre>
  </div>
  <div class="snippet">
    <p class="description">send a command-line message to all logged-in users</p>
    <pre>wall</pre>
  </div>
  <div class="snippet">
    <p class="description">find a file</p>
    <pre>find . -iname '*<em>$filename</em>'</pre>
  </div>
  <div class="snippet">
    <p class="description">show all running processes and search output</p>
    <pre>ps aux | grep <em>$query</em></pre>
  </div>
  <div class="snippet">
    <p class="description">list currently active service ports</p>
    <pre>netstat -tulpn</pre>
  </div>
  <div class="snippet">
    <p class="description">display the contents of a file</p>
    <pre>cat <em>$filename</em></pre>
  </div>
  <div class="snippet">
    <p class="description">display the first 50 lines of a file</p>
    <pre>head -n 50 <em>$filename</em></pre>
  </div>
  <div class="snippet">
    <p class="description">display the last 40 lines of a file</p>
    <pre>tail -n 40 <em>$filename</em></pre>
  </div>
</section>
{% endblock %}
